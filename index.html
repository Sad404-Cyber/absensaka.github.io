<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Hadir Siswa SMA N 4 Pontianak</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body { background-color: #f8f9fa; }
        .header { background-color: #007bff; color: white; padding: 20px; text-align: center; }
        .form-section { margin: 20px 0; }
        .table-section { margin: 20px 0; }
        .btn-export { background-color: #28a745; border-color: #28a745; }
        .btn-export:hover { background-color: #218838; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Daftar Hadir Siswa</h1>
            <p>SMA Negeri 4 Pontianak</p>
        </div>

        <!-- Form Input -->
        <div class="form-section">
            <div class="card">
                <div class="card-header">
                    <h5>Tambah Data Siswa</h5>
                </div>
                <div class="card-body">
                    <form id="attendanceForm">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="nama" class="form-label">Nama Siswa</label>
                                <input type="text" class="form-control" id="nama" required>
                            </div>
                            <div class="col-md-3">
                                <label for="kelas" class="form-label">Kelas</label>
                                <input type="text" class="form-control" id="kelas" placeholder="e.g., XI IPA 1" required>
                            </div>
                            <div class="col-md-3">
                                <label for="tanggal" class="form-label">Tanggal</label>
                                <input type="date" class="form-control" id="tanggal" value="" required>
                            </div>
                            <div class="col-md-3">
                                <label for="status" class="form-label">Status</label>
                                <select class="form-select" id="status" required>
                                    <option value="">Pilih Status</option>
                                    <option value="Hadir">Hadir</option>
                                    <option value="Sakit">Sakit</option>
                                    <option value="Izin">Izin</option>
                                    <option value="Alpha">Alpha</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-12">
                                <button type="submit" class="btn btn-primary">Tambah Data</button>
                                <button type="button" class="btn btn-secondary ms-2" onclick="clearForm()">Bersihkan Form</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tabel Daftar Hadir -->
        <div class="table-section">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Daftar Hadir Siswa</h5>
                    <button type="button" class="btn btn-export" onclick="exportToCSV()">Export ke CSV</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="attendanceTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>No</th>
                                    <th>Nama Siswa</th>
                                    <th>Kelas</th>
                                    <th>Tanggal</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <p id="emptyMessage" class="text-muted">Belum ada data. Tambahkan data siswa terlebih dahulu.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JavaScript -->
    <script>
        // Inisialisasi: Set tanggal default ke hari ini
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
            loadData(); // Load data dari localStorage
        });

        let attendanceData = []; // Array untuk menyimpan data

        // Handle submit form
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nama = document.getElementById('nama').value;
            const kelas = document.getElementById('kelas').value;
            const tanggal = document.getElementById('tanggal').value;
            const status = document.getElementById('status').value;

            // Validasi sederhana
            if (!nama || !kelas || !tanggal || !status) {
                alert('Semua field harus diisi!');
                return;
            }

            // Tambah data ke array
            const newEntry = {
                id: Date.now(), // ID unik berdasarkan timestamp
                nama: nama,
                kelas: kelas,
                tanggal: tanggal,
                status: status
            };
            attendanceData.push(newEntry);

            // Simpan ke localStorage
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));

            // Tampilkan ulang tabel
            displayTable();

            // Reset form
            clearForm();
        });

        // Fungsi bersihkan form
        function clearForm() {
            document.getElementById('attendanceForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').value = today;
        }

        // Fungsi load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('attendanceData');
            if (savedData) {
                attendanceData = JSON.parse(savedData);
                displayTable();
            }
        }

        // Fungsi tampilkan tabel
        function displayTable() {
            const tableBody = document.getElementById('tableBody');
            const emptyMessage = document.getElementById('emptyMessage');

            if (attendanceData.length === 0) {
                tableBody.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }

            emptyMessage.style.display = 'none';
            tableBody.innerHTML = '';

            attendanceData.forEach((entry, index) => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${entry.nama}</td>
                    <td>${entry.kelas}</td>
                    <td>${formatDate(entry.tanggal)}</td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(entry.status)}">${entry.status}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteEntry(${entry.id})">Hapus</button>
                    </td>
                `;
            });
        }

        // Fungsi format tanggal (DD/MM/YYYY)
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID');
        }

        // Fungsi kelas badge berdasarkan status
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'Hadir': return 'bg-success';
                case 'Sakit': return 'bg-warning';
                case 'Izin': return 'bg-info';
                case 'Alpha': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        // Fungsi hapus entry
        function deleteEntry(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                attendanceData = attendanceData.filter(entry => entry.id !== id);
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                displayTable();
            }
        }

        // Fungsi export ke CSV
        function exportToCSV() {
            if (attendanceData.length === 0) {
                alert('Tidak ada data untuk diexport!');
                return;
            }

            let csvContent = 'data:text/csv;charset=utf-8,';
            csvContent += 'No,Nama Siswa,Kelas,Tanggal,Status\n';

            attendanceData.forEach((entry, index) => {
                csvContent += `${index + 1},"${entry.nama}","${entry.kelas}","${formatDate(entry.tanggal)}","${entry.status}"\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `daftar_hadir_siswa_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
